// Copyright (c) Bentley Systems, Incorporated. All rights reserved.
// See LICENSE.md in the project root for license terms and full copyright notice.
@import '../style/index';
@import '../utils/index';
@import '../button/index';
@import '../text/mixins';

@mixin iui-side-navigation {
  --_iui-side-navigation-min-width: #{$iui-icon-large + $iui-side-navigation-icon-margins * 2};

  display: inline-flex;
  flex: 0 0 auto;
  flex-direction: column;
  height: 100%;
  background-color: var(--iui-color-background-3);
  border-right: 1px solid var(--iui-color-background-border);
  box-sizing: content-box;
  min-width: var(--_iui-side-navigation-min-width);
  max-width: var(--_iui-side-navigation-max-width);
  @media (prefers-reduced-motion: no-preference) {
    transition: max-width $iui-speed-fast ease-out;
  }
}

@mixin iui-side-navigation-state($state) {
  @if $state == collapsed {
    --_iui-side-navigation-max-width: var(--_iui-side-navigation-min-width);

    // iPhone notch support
    @supports (min-width: unquote('max(0px)')) {
      min-width: unquote(
        'max(#{$iui-icon-large} + #{$iui-side-navigation-icon-margins} * 2, #{$iui-icon-large} + #{$iui-side-navigation-icon-margins} * 2 + env(safe-area-inset-left))'
      );
      max-width: unquote(
        'max(#{$iui-icon-large} + #{$iui-side-navigation-icon-margins} * 2, #{$iui-icon-large} + #{$iui-side-navigation-icon-margins} * 2 + env(safe-area-inset-left))'
      );
    }
  }

  @if $state == expanded {
    --_iui-side-navigation-max-width: #{$iui-3xl * 3};
    --_iui-side-navigation-content-max-width: var(--_iui-side-navigation-max-width);
    --_iui-side-navigation-expander-button-icon-transform: scaleX(-1);
  }
}

@mixin iui-side-navigation-content {
  display: flex;
  flex-direction: column;
  flex-grow: 1;
  width: 100%;
  max-width: var(--_iui-side-navigation-content-max-width);

  > .iui-top,
  > .iui-bottom {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
  }

  > .iui-top {
    .iui-side-navigation-button:first-of-type {
      border-top: none;
    }

    .iui-side-navigation-button:not(:last-of-type) {
      border-bottom: none;
    }
  }

  > .iui-bottom {
    justify-content: flex-end;

    .iui-side-navigation-button {
      border-bottom: none;
    }
  }

  + .iui-side-navigation-button.iui-expand {
    border: none;
    border-top: 1px solid var(--iui-color-background-border);
  }
}

@mixin iui-side-navigation-expander-button {
  @include iui-button;
  @include iui-button-default;

  --_iui-button-border-radius: 0;
  --_iui-button-height: #{$iui-line-height};

  justify-content: center;
  border: none;

  &:first-child {
    border-bottom: 1px solid var(--iui-color-background-border);
  }

  &:last-child {
    border-top: 1px solid var(--iui-color-background-border);
  }
}

@mixin iui-side-navigation-expander-button-icon {
  @include iui-icon-style('s');
  @include iui-icon-color;
  transform: var(--_iui-side-navigation-expander-button-icon-transform);
  @media (prefers-reduced-motion: no-preference) {
    transition: transform $iui-speed ease-out;
  }
}

@mixin iui-side-navigation-button {
  @include iui-button;
  @include iui-button-default;
  @include iui-button-size(large);

  &[data-iui-active='true'] {
    @include iui-button-default-active;
    --_iui-button-active-stripe-inset: 0 0 0 calc(100% - #{$iui-xxs});
  }

  --_iui-button-border-radius: 0;
  --_iui-button-gap: #{$iui-side-navigation-icon-margins};
  --_iui-button-height: #{$iui-baseline * 5};

  border-left: none;
  border-right: none;
  overflow: hidden;
  justify-content: flex-start;

  &[aria-selected='true'] {
    color: var(--iui-color-foreground-primary);
  }

  &,
  &:hover,
  &[disabled],
  &:disabled,
  &[aria-disabled='true'] {
    --_iui-button-border-color: var(--iui-color-background-border);
  }

  &[disabled],
  &:disabled,
  &[aria-disabled='true'] {
    --_iui-button-background-color: var(--iui-color-background-2);
  }

  // iPhone notch support
  @supports (padding: unquote('max(0px)')) {
    padding-left: unquote(
      'max(#{$iui-side-navigation-icon-margins}, #{$iui-side-navigation-icon-margins} + env(safe-area-inset-left))'
    );
  }
}

@mixin iui-side-navigation-button-icon {
  @include iui-icon-style('l');
  transition: fill $iui-speed-fast ease-out;
  fill: currentColor;
}

@mixin iui-side-navigation-button-label {
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

@mixin iui-side-navigation-wrapper {
  display: flex;
  position: relative;
  height: 100%;
}
