import{r as e,q as U,n as W,w as j,A as G,C as J,D as O,d as A,y as Q,P as X,e as Y,B as Z,c as _,m as $}from"./index-Da93hvVR.js";import{g as ee}from"./focusable-DQv_vybo.js";import{L as b}from"./ListItem-8-W8Bsdo.js";import{u as ne}from"./Popover-v2-btKYE.js";const te=l=>e.createElement(U,{...l},e.createElement("path",{d:"M6.003 4.807v6.4a.28.28 0 0 0 .443.24L9.9 8.27a.34.34 0 0 0 0-.48L6.446 4.566a.269.269 0 0 0-.443.24z"})),se=Y(),k=e.createContext({setCurrentFocusedNodeIndex:()=>{},focusableNodes:{current:[]},setHasFocusedNodeInSubmenu:void 0}),le=e.forwardRef((l,F)=>{const{children:h,isSelected:N,disabled:r,value:d,onClick:u,sublabel:i,size:v=i?"large":"default",icon:f,startIcon:c=f,badge:C,endIcon:n=C,role:a="menuitem",subMenuItems:s=[],...x}=l;u!=null&&s.length>0&&se("Passing a non-empty submenuItems array and onClick to MenuItem at the same time is not supported. This is because when a non empty submenuItems array is passed, clicking the MenuItem toggles the submenu visibility.");const m=e.useContext(k),S=e.useRef(null),w=W(),[H,y]=e.useState(!1),[T,R]=e.useState(null),[z,M]=e.useState(!1),p=j(),o=G(),E=J(),D=m.focusableNodes.current.findIndex(t=>t===S.current);O(e.useCallback(()=>{const t=I=>{(E===I.parentId&&p!==I.nodeId||E===I.nodeId)&&(y(!1),M(!1))};return o==null||o.events.on("onNodeFocused",t),()=>{o==null||o.events.off("onNodeFocused",t)}},[p,E,o==null?void 0:o.events]),()=>{},()=>{});const P=e.useRef([]),g=ne({nodeId:p,visible:H,onVisibleChange:e.useCallback(t=>{t||M(!1),y(t)},[]),placement:"right-start",interactions:r?{}:{click:!1,hover:{enabled:!z},listNavigation:{listRef:P,activeIndex:T,nested:s.length>0,onNavigate:R}}}),V=t=>{if(!t.altKey)switch(t.key){case"Enter":case" ":case"Spacebar":{K(),t.preventDefault();break}}},q=t=>{var I;t.target===t.currentTarget&&((I=S.current)==null||I.focus(),m!=null&&D!=null&&m.setCurrentFocusedNodeIndex(D))},B=()=>{queueMicrotask(()=>{var t;(t=m.setHasFocusedNodeInSubmenu)==null||t.call(m,!0)}),o==null||o.events.emit("onNodeFocused",{nodeId:p,parentId:E})},K=()=>{u==null||u(d),y(t=>!t)},L=r?{}:{onClick:K,onKeyDown:V,onMouseEnter:q,onFocus:B};return e.createElement(e.Fragment,null,e.createElement(b,{as:"div",actionable:!0,size:v,active:N,disabled:r,ref:A(S,F,s.length>0?g.refs.setReference:null),role:a,tabIndex:r||a==="presentation"?void 0:-1,"aria-selected":N,"aria-haspopup":s.length>0?"true":void 0,"aria-controls":s.length>0?w:void 0,"aria-expanded":s.length>0?g.open:void 0,"aria-disabled":r,...s.length===0?{...L,...x}:g.getReferenceProps({...L,...x})},c&&e.createElement(b.Icon,{as:"span","aria-hidden":!0},c),e.createElement(b.Content,null,e.createElement("div",null,h),i&&e.createElement(b.Description,null,i)),!n&&s.length>0&&e.createElement(b.Icon,{as:"span","aria-hidden":!0},e.createElement(te,null)),n&&e.createElement(b.Icon,{as:"span","aria-hidden":!0},n)),s.length>0&&!r&&g.open&&e.createElement(Q,{id:p},e.createElement(X,null,e.createElement(k.Provider,{value:{setCurrentFocusedNodeIndex:R,focusableNodes:P,setHasFocusedNodeInSubmenu:M}},e.createElement(ae,{setFocus:!1,ref:g.refs.setFloating,...g.getFloatingProps({id:w})},s)))))}),ae=e.forwardRef((l,F)=>{const{setFocus:h=!0,className:N,...r}=l,[d,u]=e.useState(),i=e.useRef(null),v=A(i,F),f=e.useContext(k),c=e.useCallback(()=>{const n=ee(i.current);return n.filter(a=>!n.some(s=>s.contains(a.parentElement)))},[]);e.useEffect(()=>{const n=c();f!=null&&f.focusableNodes.current!==n&&(f.focusableNodes.current=n)},[c,f]),e.useEffect(()=>{var s;const n=c();if(d!=null){(s=n==null?void 0:n[d])==null||s.focus();return}const a=n.findIndex(x=>x.getAttribute("aria-selected")==="true");h&&u(a>-1?a:0)},[h,d,c]);const C=n=>{if(n.altKey)return;const a=c();if(!(a!=null&&a.length))return;const s=d??0;switch(n.key){case"ArrowDown":{u(Math.min(s+1,a.length-1)),n.preventDefault(),n.stopPropagation();break}case"ArrowUp":{u(Math.max(s-1,0)),n.preventDefault(),n.stopPropagation();break}}};return e.createElement(Z,{as:"div",className:_("iui-menu",N),role:"menu",ref:v,...r,onKeyDown:$(l.onKeyDown,C)})});export{le as M,k as a,ae as b};
